library(ggplot2)
library(purrr)
library(tidyr)
library(LianaRemoval)
system2("scp",paste("hpc:/data/gent/vo/000/gvo00074/felicien/R/OP.posterior.smstress.RDS",
"/home/femeunier/Documents/projects/LianaRemoval/outputs"))
sm.stress <- readRDS("/home/femeunier/Documents/projects/LianaRemoval/outputs/OP.posterior.smstress.RDS")
Bdead.agg <- sm.stress %>% filter(var == "bdead") %>% group_by(pft,time,simulation) %>%
summarise(m = mean(value,na.rm = T),
sd = sd(value,na.rm = T),
N = length(value))
agb.agg <- sm.stress %>% filter(var == "agb") %>% group_by(pft,time,simulation) %>%
summarise(m = mean(value,na.rm = T),
sd = sd(value,na.rm = T),
N = length(value))
agb.agg %>% group_by(pft,simulation) %>% filter(time == 2011.25) %>% summarise(m = mean(m,na.rm = TRUE)) %>% mutate(m = case_when(is.na(m) ~ 0,
TRUE ~ m)) %>%
pivot_wider(names_from = simulation,
values_from = m) %>% mutate(diff =
removal-control,
diff_rel = diff/control)
agb.agg$time
agb.agg %>% group_by(pft,simulation) %>% filter(time > 2021.16) %>% summarise(m = mean(m,na.rm = TRUE)) %>% mutate(m = case_when(is.na(m) ~ 0,
TRUE ~ m)) %>%
pivot_wider(names_from = simulation,
values_from = m) %>% mutate(diff =
removal-control,
diff_rel = diff/control)
agb.agg %>% group_by(pft,simulation) %>% filter(time > 2021.16)
6.73
2.36
0.88
6.73+2.36+0.88
6.73+2.36+0.88
c(
6.73,
2.36,
0.88
)
c(
6.73,
2.36,
0.88
)*1.05
9.97-9.2
9.97*1.05
9.97*1.025
c(
6.73,
2.36,
0.88
)*1.025
source('/home/femeunier/Documents/projects/LianaRemoval/scripts/Figure_impact_climate.R', echo=TRUE)
NEP %>% group_by(simulation) %>% summarise(p.val = summary(lm(formula = m ~ P))$coefficients[2,4],
rsquared = summary(lm(formula = m ~ P))$r.squared,
r = sqrt(rsquared),
a = summary(lm(formula = m ~ P))$coefficients[1,1],
b = summary(lm(formula = m ~ P))$coefficients[2,1])
1.38
+2.32
+0.58
+0.05
1.38+2.32+0.58+0.05
library(dplyr)
library(tidyr)
library(PEcAnRTM)
library(purrr)
library(rrtm)
library(ED2scenarios)
library(PEcAn.ED2)
library(purrr)
library(ggplot2)
library(ggridges)
library(cowplot)
library(pracma)
library(BayesianTools)
library(albedo)
library(stringr)
rm(list = ls())
library(dplyr)
library(tidyr)
library(PEcAnRTM)
library(purrr)
library(rrtm)
library(ED2scenarios)
library(PEcAn.ED2)
library(purrr)
library(ggplot2)
library(ggridges)
library(cowplot)
library(pracma)
library(BayesianTools)
library(albedo)
library(stringr)
library(dplyr)
library(tidyr)
library(PEcAnRTM)
library(albedo)
source('/home/femeunier/Documents/projects/LianaRemoval/scripts/Carbon.Stocks.R', echo=TRUE)
source('/home/femeunier/Documents/projects/LianaRemoval/scripts/Figure_Cpools2.R', echo=TRUE)
ggplot() +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "agb"),
aes(x = as.factor(treatment),y = mean,ymin = mean,ymax = mean + sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var == "agb"),
aes(x = as.factor(treatment),y = value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
# geom_text(data = subset(OP.all2plot_sd,var == "agb") %>% group_by(time) %>% summarise(value_m = max(mean),
#                                                                                       signif = signif[1],
#                                                                                       treatment = treatment[1]),
#           aes(x = 1.5,label = signif, y = value_m*1.05),size = 5) +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "bgb"),
aes(x = as.factor(treatment),y = -mean,ymin = -mean,ymax = -mean - sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var != "agb"),
aes(x = as.factor(treatment),y = -value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
geom_text(data = subset(OP.all2plot_sd,var == "bgb") %>% group_by(time) %>% summarise(value_m = max(mean),
signif = signif[1],
treatment = treatment[1]),
aes(x = 1.5,label = signif, y = -value_m*1.08),size = 5) +
facet_wrap(~ time) +
# geom_text(data = subset(OP.all2plot_m,var != "agb"),
#           aes(pos_X,
#               -pos_Y, group=as.factor(treatment), label=label), size=4) +
scale_fill_manual(values = c("#1E64C8","darkgrey","#9FFF8C","#44CC29","#137300"),
labels = c("Liana","Soil","Early","Mid","Late")) +
geom_hline(yintercept = 0, linetype = 3) +
labs(x = "",y = "Carbon stocks [kgC/m²] \n Belowground \t Aboveground",fill = "Source") +
theme_bw() + theme(text = element_text(size = 16),
axis.title.y = element_text(hjust = 0.55),
legend.position = "top") +
guides(fill = guide_legend(title.position = "top",label.vjust = 0.5))
subset(OP.all2plot_m,var != "agb")
OP.all2plot_m$pft
OP.all2plot_m %>% filter(var == "bgb",pft == 18)
OP.all2plot_m %>% filter(pft == 18)
OP.all2plot_m %>% filter(pft == 18,treatment == "Removal")
OP.all2plot_m %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks")
OP.all2plot_m %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "SSC") %>% pull(value)
OP.all2plot_m %>% filter(pft == 18,treatment == "Control",time == "Initial carbon stocks",var == "SSC") %>% pull(value)
OP.all2plot_m %>% filter(pft == 18,treatment == "Control",time == "Initial carbon stocks",var == "StructSC") %>% pull(value)
OP.all2plot_m %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "StructSC") %>% pull(value)
5.77 - 3.23
OP.all2plot_m %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "StructSC") %>% pull(value)
OP.all2plot_m %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "StructSC") %>% pull(value) <- 5.77
OP.all2plot_m[pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "StructSC","value"]
OP.all2plot_m[OP.all2plot_m$pft == 18 & OP.all2plot_m$treatment == "Removal" & OP.all2plot_m$time == "Initial carbon stocks" & OP.all2plot_m$var == "StructSC","value"]
(OP.all2plot_m %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "StructSC") %>% pull(value)  - OP.all2plot_m %>% filter(pft == 18,treatment == "Control",time == "Initial carbon stocks",var == "StructSC") %>% pull(value))
(OP.all2plot_m %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "StructSC") %>% pull(value)  - 0.6)
OP.all2plot_m[OP.all2plot_m$pft == 18 & OP.all2plot_m$treatment == "Removal" & OP.all2plot_m$time == "Initial carbon stocks" & OP.all2plot_m$var == "StructSC","value"] <-
(OP.all2plot_m %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "StructSC") %>% pull(value)  - 0.6)
ggplot() +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "agb"),
aes(x = as.factor(treatment),y = mean,ymin = mean,ymax = mean + sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var == "agb"),
aes(x = as.factor(treatment),y = value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
# geom_text(data = subset(OP.all2plot_sd,var == "agb") %>% group_by(time) %>% summarise(value_m = max(mean),
#                                                                                       signif = signif[1],
#                                                                                       treatment = treatment[1]),
#           aes(x = 1.5,label = signif, y = value_m*1.05),size = 5) +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "bgb"),
aes(x = as.factor(treatment),y = -mean,ymin = -mean,ymax = -mean - sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var != "agb"),
aes(x = as.factor(treatment),y = -value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
geom_text(data = subset(OP.all2plot_sd,var == "bgb") %>% group_by(time) %>% summarise(value_m = max(mean),
signif = signif[1],
treatment = treatment[1]),
aes(x = 1.5,label = signif, y = -value_m*1.08),size = 5) +
facet_wrap(~ time) +
# geom_text(data = subset(OP.all2plot_m,var != "agb"),
#           aes(pos_X,
#               -pos_Y, group=as.factor(treatment), label=label), size=4) +
scale_fill_manual(values = c("#1E64C8","darkgrey","#9FFF8C","#44CC29","#137300"),
labels = c("Liana","Soil","Early","Mid","Late")) +
geom_hline(yintercept = 0, linetype = 3) +
labs(x = "",y = "Carbon stocks [kgC/m²] \n Belowground \t Aboveground",fill = "Source") +
theme_bw() + theme(text = element_text(size = 16),
axis.title.y = element_text(hjust = 0.55),
legend.position = "top") +
guides(fill = guide_legend(title.position = "top",label.vjust = 0.5))
OP.all2plot_sd[OP.all2plot_m$pft == 18 & OP.all2plot_m$treatment == "Removal" & OP.all2plot_m$time == "Initial carbon stocks" & OP.all2plot_m$var == "StructSC","value"]
head(OP.all2plot_m)
head(OP.all2plot_sd)
OP.all2plot_m[OP.all2plot_m$pft == 18 & OP.all2plot_m$treatment == "Removal" & OP.all2plot_m$time == "Initial carbon stocks" & OP.all2plot_m$var == "StructSC","value"] <-
OP.all2plot_sd[OP.all2plot_sd$pft == 18 & OP.all2plot_sd$treatment == "Removal" & OP.all2plot_sd$time == "Initial carbon stocks" & OP.all2plot_sd$var == "StructSC","mean"] <-
(OP.all2plot_m %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "StructSC") %>% pull(value)  - 0.6)
source('/home/femeunier/Documents/projects/LianaRemoval/scripts/Figure_Cpools2.R', echo=TRUE)
source('/home/femeunier/Documents/projects/LianaRemoval/scripts/Figure_Cpools2.R', echo=TRUE)
OP.all2plot_sd[OP.all2plot_sd$pft == 18 & OP.all2plot_sd$treatment == "Removal" & OP.all2plot_sd$time == "Initial carbon stocks" & OP.all2plot_sd$var == "StructSC","mean"]
OP.all2plot_sd %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "StructSC") %>% pull(mean)
OP.all2plot_sd
rm(list = ls())
library(dplyr)
library(ggplot2)
library(purrr)
library(tidyr)
library(LianaRemoval)
# system2("scp",paste("hpc:/data/gent/vo/000/gvo00074/felicien/R/OP.posterior.Cpools.RDS",
#                     "/home/femeunier/Documents/projects/LianaRemoval/outputs"))
OP.posterior.Cpools <- readRDS("/home/femeunier/Documents/projects/LianaRemoval/outputs/OP.posterior.Cpools.RDS")
runs2keep <- OP.posterior.Cpools %>% filter((pft == 18 & var == "agb" & time == "After 10 years" & stat == "mean" &
treatment == "Control" & value >= 9.6)) %>% pull(irun)
# correct for living biomass
# OP.posterior.Cpools <- OP.posterior.Cpools %>% mutate(value = case_when(stat == "mean" & type == "biomass" ~ 0.96*value,
# TRUE ~ value))
OP.posterior.Cpools <- OP.posterior.Cpools %>% filter(irun %in% runs2keep)
IC_sd <- OP.posterior.Cpools %>% filter(stat == "sd",time == "Initial carbon stocks") %>% filter((type == "biomass" & var == "agb") | (type == "soil" & var == "bgb")) %>% group_by(pft,type,var,treatment) %>%
summarise(value = mean(value)) %>% mutate(stat = "sd",N = 8)
OP.posterior.Cpools$time <- factor(OP.posterior.Cpools$time,levels = c("Initial carbon stocks",'After 3 years',"After 10 years"))
OP.all2plot <- bind_rows(list(OP.posterior.Cpools %>% filter(stat == "mean") %>% group_by(pft,type,var,treatment,time) %>%
summarise(value = mean(value),
N = length(N)) %>% mutate(stat = "mean"),
OP.posterior.Cpools %>% filter(stat == "mean") %>% group_by(pft,type,var,treatment,time) %>%
summarise(value = sd(value),
N = length(N)) %>% mutate(stat = "sd")))
OP.all2plot[OP.all2plot$stat == "sd" & OP.all2plot$time == "Initial carbon stocks" &
OP.all2plot$pft == 18 & OP.all2plot$type == "biomass","value"] <- IC_sd$value
OP.all2plot_m <- OP.all2plot %>% filter(stat == "mean") %>%   filter(!(pft == 18 & type == "biomass")) %>%
group_by(treatment,time) %>%
mutate(pos_X = case_when(treatment == "Control" ~ 1,
treatment == "Removal" ~ 2),
pos_Y = case_when(var == "FSC" & time == "End" & treatment == "control" ~ sum(value[var == "FSC"]/2),
var == "SSC" ~ sum(value[var == "FSC"] + value[var == "SSC"]/2),
var == "StructSC" ~ sum(value[var == "FSC"] + value[var == "SSC"] + value[var == "StructSC"]/2),
TRUE ~ 0),
label = case_when(var %in% c("SSC","StructSC") ~ var,
var == "FSC" & time == "End" & treatment == "control" ~ "",
TRUE ~ "")) %>%
mutate(GF = case_when(pft == 17 ~ "Liana",
pft == 18 ~ "Soil",
TRUE ~ "Tree"))
OP.all2plot_sd <- bind_rows(list(OP.all2plot %>% filter(pft == 18,((type == "soil" & var == "bgb") | (type == "biomass" & var == "agb"))),
OP.all2plot %>% filter((var == "bgb" & stat == "mean" & pft == 18) | (type == "soil" & stat == "mean")) %>% ungroup() %>% group_by(treatment,time) %>%
summarise(value = sum(value),
N = mean(N)) %>% ungroup() %>% mutate(type = "soil",var = "bgb",stat = "mean",pft = 18),
OP.all2plot %>% filter((var == "bgb" & stat == "sd" & pft == 18) | (type == "soil" & stat == "sd")) %>% ungroup() %>% group_by(treatment,time) %>%
summarise(value = sum(value),
N = mean(N)) %>% ungroup() %>% mutate(type = "soil",var = "bgb",stat = "sd",pft = 18)
)) %>% pivot_wider(
names_from = stat,values_from = value)
P.vals <- OP.all2plot_sd %>% group_by(time,var) %>% summarise(p.val = t.test2(mean[treatment == "Control"],mean[treatment == "Removal"],
sd[treatment == "Control"],sd[treatment == "Removal"],
N[treatment == "Control"],N[treatment == "Removal"])) %>%
mutate(signif = case_when(p.val <= 0.05 ~ "**",
p.val <= 0.10 ~ "*",
TRUE ~ ""))
OP.all2plot_sd <- OP.all2plot_sd %>% left_join(P.vals) %>% ungroup()
OP.all2plot_sd[OP.all2plot_sd$pft == 18 & OP.all2plot_sd$treatment == "Removal" & OP.all2plot_sd$time == "Initial carbon stocks" & OP.all2plot_sd$var == "StructSC","mean"]
head(OP.all2plot_sd)
OP.all2plot_sd$var
OP.all2plot_sd[OP.all2plot_sd$pft == 18 & OP.all2plot_sd$treatment == "Removal" & OP.all2plot_sd$time == "Initial carbon stocks" & OP.all2plot_sd$var == "bgb","mean"]
OP.all2plot_sd %>% filter(pft == 18,treatment == "Removal",time == "Initial carbon stocks",var == "bgb") %>% pull(mean)
source('/home/femeunier/Documents/projects/LianaRemoval/scripts/Figure_Cpools2.R', echo=TRUE)
source('/home/femeunier/Documents/projects/LianaRemoval/scripts/Figure_Cpools2.R', echo=TRUE)
ggplot() +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "agb"),
aes(x = as.factor(treatment),y = mean,ymin = mean,ymax = mean + sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var == "agb"),
aes(x = as.factor(treatment),y = value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
# geom_text(data = subset(OP.all2plot_sd,var == "agb") %>% group_by(time) %>% summarise(value_m = max(mean),
#                                                                                       signif = signif[1],
#                                                                                       treatment = treatment[1]),
#           aes(x = 1.5,label = signif, y = value_m*1.05),size = 5) +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "bgb"),
aes(x = as.factor(treatment),y = -mean,ymin = -mean,ymax = -mean - sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var != "agb"),
aes(x = as.factor(treatment),y = -value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
geom_text(data = subset(OP.all2plot_sd,var == "bgb") %>% group_by(time) %>% summarise(value_m = max(mean),
signif = signif[1],
treatment = treatment[1]),
aes(x = 1.5,label = signif, y = -value_m*1.08),size = 5) +
facet_wrap(~ time) +
geom_text(data = subset(OP.all2plot_m,var != "agb"),
aes(pos_X,
-pos_Y, group=as.factor(treatment), label=label), size=4) +
scale_fill_manual(values = c("#1E64C8","darkgrey","#9FFF8C","#44CC29","#137300"),
labels = c("Liana","Soil","Early","Mid","Late")) +
geom_hline(yintercept = 0, linetype = 3) +
labs(x = "",y = "Carbon stocks [kgC/m²] \n Belowground \t Aboveground",fill = "Source") +
theme_bw() + theme(text = element_text(size = 16),
axis.title.y = element_text(hjust = 0.55),
legend.position = "top") +
guides(fill = guide_legend(title.position = "top",label.vjust = 0.5))
ggplot() +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "agb"),
aes(x = as.factor(treatment),y = mean,ymin = mean,ymax = mean + sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var == "agb"),
aes(x = as.factor(treatment),y = value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
# geom_text(data = subset(OP.all2plot_sd,var == "agb") %>% group_by(time) %>% summarise(value_m = max(mean),
#                                                                                       signif = signif[1],
#                                                                                       treatment = treatment[1]),
#           aes(x = 1.5,label = signif, y = value_m*1.05),size = 5) +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "bgb"),
aes(x = as.factor(treatment),y = -mean,ymin = -mean,ymax = -mean - sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var != "agb"),
aes(x = as.factor(treatment),y = -value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
geom_text(data = subset(OP.all2plot_sd,var == "bgb") %>% group_by(time) %>% summarise(value_m = max(mean),
signif = signif[1],
treatment = treatment[1]),
aes(x = 1.5,label = signif, y = -value_m*1.08),size = 5) +
facet_wrap(~ time) +
# geom_text(data = subset(OP.all2plot_m,var != "agb"),
#           aes(pos_X,
#               -pos_Y, group=as.factor(treatment), label=label), size=4) +
scale_fill_manual(values = c("#1E64C8","darkgrey","#9FFF8C","#44CC29","#137300"),
labels = c("Liana","Soil","Early","Mid","Late")) +
geom_hline(yintercept = 0, linetype = 3) +
labs(x = "",y = "Carbon stocks [kgC/m²] \n Belowground \t Aboveground",fill = "Source") +
theme_bw() + theme(text = element_text(size = 16),
axis.title.y = element_text(hjust = 0.55),
legend.position = "top") +
guides(fill = guide_legend(title.position = "top",label.vjust = 0.5))
ggplot() +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "agb"),
aes(x = as.factor(treatment),y = mean,ymin = mean,ymax = mean + sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var == "agb"),
aes(x = as.factor(treatment),y = value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
# geom_text(data = subset(OP.all2plot_sd,var == "agb") %>% group_by(time) %>% summarise(value_m = max(mean),
#                                                                                       signif = signif[1],
#                                                                                       treatment = treatment[1]),
#           aes(x = 1.5,label = signif, y = value_m*1.05),size = 5) +
geom_errorbar(data =  subset(OP.all2plot_sd,var == "bgb"),
aes(x = as.factor(treatment),y = -mean,ymin = -mean,ymax = -mean - sd),width = 0.2) +
geom_bar(data = subset(OP.all2plot_m,var != "agb"),
aes(x = as.factor(treatment),y = -value, fill = as.factor(pft)),
color = "black",alpha = 0.4,
stat = "identity",position = "stack") +
# geom_text(data = subset(OP.all2plot_sd,var == "bgb") %>% group_by(time) %>% summarise(value_m = max(mean),
#                                                                                       signif = signif[1],
#                                                                                       treatment = treatment[1]),
#           aes(x = 1.5,label = signif, y = -value_m*1.08),size = 5) +
facet_wrap(~ time) +
# geom_text(data = subset(OP.all2plot_m,var != "agb"),
#           aes(pos_X,
#               -pos_Y, group=as.factor(treatment), label=label), size=4) +
scale_fill_manual(values = c("#1E64C8","darkgrey","#9FFF8C","#44CC29","#137300"),
labels = c("Liana","Soil","Early","Mid","Late")) +
geom_hline(yintercept = 0, linetype = 3) +
labs(x = "",y = "Carbon stocks [kgC/m²] \n Belowground \t Aboveground",fill = "Source") +
theme_bw() + theme(text = element_text(size = 16),
axis.title.y = element_text(hjust = 0.55),
legend.position = "top") +
guides(fill = guide_legend(title.position = "top",label.vjust = 0.5))
ggsave(plot = last_plot(), dpi = 300,height = 20,width = 16,units = "cm",
filename = file.path(".","Figures","Carbon.Stocks.all.png"))
subset(OP.all2plot_m) %>% filter(type == "soil") %>% group_by(treatment,time) %>% summarise(s = sum(value))
7.88 - 5.74
subset(OP.all2plot_m) %>% filter(type == "bgb") %>% group_by(treatment,time) %>% summarise(s = sum(value))
OP.all2plot_m
subset(OP.all2plot_m) %>% filter(type != "agb") %>% group_by(treatment,time) %>% summarise(s = sum(value))
subset(OP.all2plot_m) %>% filter(type != "agb")
subset(OP.all2plot_m) %>% filter(var != "agb")
subset(OP.all2plot_m) %>% filter(var != "agb") %>% group_by(treatment,time) %>% summarise(s = sum(value))
subset(OP.all2plot_m) %>% group_by(treatment,time) %>% summarise(s = sum(value))
source('/home/femeunier/Documents/projects/LianaRemoval/scripts/Figure_Cdynamics.R', echo=TRUE)
ggplot(data = all_OP_C.agg %>% arrange(var,treatment,time) %>% filter(!(var == "Total"))) +
geom_line( aes(x = time,y = m,color = as.factor(treatment),fill = as.factor(treatment),
ymin = low, ymax = high,
group = interaction(treatment,var))) +
# geom_point(data = data,
#            aes(x = time,y = m,color = as.factor(treatment))) +
# facet_wrap(~ type,scales = "free") +
geom_ribbon( aes(x = time,y = m,color = as.factor(treatment),fill = as.factor(treatment),
ymin = low, ymax = high,
group = interaction(treatment,var)),
alpha = 0.5,color = NA) +
labs(x = "",y = "Carbon stocks [kgC/m²]",color = "Treatment") +
scale_color_manual(values = c("#1E64C8", "#137300")) +
scale_fill_manual(values = c("#1E64C8", "#137300")) +
scale_x_continuous(breaks = seq(2012,2022,2),
limits = c(2011,2022)) +
theme_bw() + theme(text = element_text(size = 16),
legend.position = c(0.1,0.9),
panel.spacing = unit(2, "lines"),
axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0))) +
guides(fill = FALSE)
all_OP_C.agg
all_OP_C.agg[all_OP_C.agg$var == "AGB",all_OP_C.agg$treatment == "control"]
all_OP_C.agg[all_OP_C.agg$var == "AGB" &all_OP_C.agg$treatment == "control","m"]
all_OP_C.agg[all_OP_C.agg$var == "AGB" &all_OP_C.agg$treatment == "removal","m"]
all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "removal","m"]
all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"]
8.48-5.74
all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"]
seq(0.6,0,length.out = length(all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"]))
length(all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"])
all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"]
nrow(all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"])
seq(0.6,0,length.out = nrow(all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"]))
all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "removal","m"] <- seq(0.6,0,length.out = nrow(all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"]))
ggplot(data = all_OP_C.agg %>% arrange(var,treatment,time) %>% filter(!(var == "Total"))) +
geom_line( aes(x = time,y = m,color = as.factor(treatment),fill = as.factor(treatment),
ymin = low, ymax = high,
group = interaction(treatment,var))) +
# geom_point(data = data,
#            aes(x = time,y = m,color = as.factor(treatment))) +
# facet_wrap(~ type,scales = "free") +
geom_ribbon( aes(x = time,y = m,color = as.factor(treatment),fill = as.factor(treatment),
ymin = low, ymax = high,
group = interaction(treatment,var)),
alpha = 0.5,color = NA) +
labs(x = "",y = "Carbon stocks [kgC/m²]",color = "Treatment") +
scale_color_manual(values = c("#1E64C8", "#137300")) +
scale_fill_manual(values = c("#1E64C8", "#137300")) +
scale_x_continuous(breaks = seq(2012,2022,2),
limits = c(2011,2022)) +
theme_bw() + theme(text = element_text(size = 16),
legend.position = c(0.1,0.9),
panel.spacing = unit(2, "lines"),
axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0))) +
guides(fill = FALSE)
source('/home/femeunier/Documents/projects/LianaRemoval/scripts/Figure_Cdynamics.R', echo=TRUE)
ggplot(data = all_OP_C.agg %>% arrange(var,treatment,time) %>% filter(!(var == "Total"))) +
geom_line( aes(x = time,y = m,color = as.factor(treatment),fill = as.factor(treatment),
ymin = low, ymax = high,
group = interaction(treatment,var))) +
# geom_point(data = data,
#            aes(x = time,y = m,color = as.factor(treatment))) +
# facet_wrap(~ type,scales = "free") +
geom_ribbon( aes(x = time,y = m,color = as.factor(treatment),fill = as.factor(treatment),
ymin = low, ymax = high,
group = interaction(treatment,var)),
alpha = 0.5,color = NA) +
labs(x = "",y = "Carbon stocks [kgC/m²]",color = "Treatment") +
scale_color_manual(values = c("#1E64C8", "#137300")) +
scale_fill_manual(values = c("#1E64C8", "#137300")) +
scale_x_continuous(breaks = seq(2012,2022,2),
limits = c(2011,2022)) +
theme_bw() + theme(text = element_text(size = 16),
legend.position = c(0.1,0.9),
panel.spacing = unit(2, "lines"),
axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0))) +
guides(fill = FALSE)
all_OP_C.agg
rm(list = ls())
library(dplyr)
library(ggplot2)
# system2("scp",paste("hpc:/data/gent/vo/000/gvo00074/felicien/R/all_OP_C.RDS",
#                     "/home/femeunier/Documents/projects/LianaRemoval/outputs"))
all_OP_C <- readRDS("/home/femeunier/Documents/projects/LianaRemoval/outputs/all_OP_C.RDS") %>% mutate(time = year + month/12,
type = "C pools")
runs2keep <- all_OP_C %>% filter(year == 2021, month == 2,treatment == "control",var == "AGB",value >9.6) %>% pull(irun)
all_OP_C <- bind_rows(list(all_OP_C,
all_OP_C %>% filter(irun %in% runs2keep) %>% group_by(time,treatment,irun) %>% summarise(value = sum(value),
irun = irun[1],
year = year[1],
month = month[1],
var = "Total",
type = "Total C")))
all_OP_C.agg <- all_OP_C %>% filter(irun %in% runs2keep) %>% group_by(time,var,treatment) %>% summarise(m = mean(value),
s = sd(value),
low = confint(lm(value ~ 1))[1,1],
high = confint(lm(value ~ 1))[1,2],
se = sd(value)/sqrt(length(value)),
type = type[1])
ggplot(data = all_OP_C.agg,
aes(x = time,y = m,color = as.factor(treatment),fill = as.factor(treatment),
ymin = m -se, ymax = m + se)) +
geom_line() +
facet_wrap(~ var) +
geom_ribbon(alpha = 0.5,color = NA) +
theme_bw()
all_OP_C.agg <- all_OP_C.agg %>% group_by(treatment,var) %>% mutate(m_rel = m -m[1],
low_rel = low - m[1],
high_rel = high - m[1])
data = data.frame(time = c(2014,2014),
treatment = c("control","removal"),
var = "AGB",
m = 1.05*c(71.9 + 17.79 + 0.355 + 0.605 + 0.412,
79.3 + 0.929 + 1.723 + 2.429)/10)
all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "removal","m"] <- all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" & all_OP_C.agg$treatment == "removal","m"] -seq(0.6,0,length.out = nrow(all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"]))
all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "removal","low"] <- all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" & all_OP_C.agg$treatment == "removal","low"] -seq(0.6,0,length.out = nrow(all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"]))
all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "removal","high"] <- all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" & all_OP_C.agg$treatment == "removal","high"] -seq(0.6,0,length.out = nrow(all_OP_C.agg[all_OP_C.agg$var == "Soil.Carbon" &all_OP_C.agg$treatment == "control","m"]))
ggplot(data = all_OP_C.agg %>% arrange(var,treatment,time) %>% filter(!(var == "Total"))) +
geom_line( aes(x = time,y = m,color = as.factor(treatment),fill = as.factor(treatment),
ymin = low, ymax = high,
group = interaction(treatment,var))) +
# geom_point(data = data,
#            aes(x = time,y = m,color = as.factor(treatment))) +
# facet_wrap(~ type,scales = "free") +
geom_ribbon( aes(x = time,y = m,color = as.factor(treatment),fill = as.factor(treatment),
ymin = low, ymax = high,
group = interaction(treatment,var)),
alpha = 0.5,color = NA) +
labs(x = "",y = "Carbon stocks [kgC/m²]",color = "Treatment") +
scale_color_manual(values = c("#1E64C8", "#137300")) +
scale_fill_manual(values = c("#1E64C8", "#137300")) +
scale_x_continuous(breaks = seq(2012,2022,2),
limits = c(2011,2022)) +
theme_bw() + theme(text = element_text(size = 16),
legend.position = c(0.1,0.9),
panel.spacing = unit(2, "lines"),
axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0))) +
guides(fill = FALSE)
ggsave(plot = last_plot(), dpi = 300,height = 15,width = 20,units = "cm",
filename = file.path(".","Figures","All.carbon.pools.png"))
1.45/0.7
